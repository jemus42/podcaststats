---
title: "Accidental Tech Podcast"
date: "`r format(Sys.time(), '%F %R', tz = 'UTC', usetz = T)`"
author: "Lukas — @jemus42"
output:
  html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, echo=FALSE, cache=FALSE, include=FALSE}
source("00_setup.R")

## Global options
#options(max.print = "75")
opts_chunk$set(fig.path = "assets/atp/")

#opts_knit$set(width = 90)

#### Data Prep ####
atp <- readRDS("data/atp.rds") %>%
  filter(!is.na(month), !is.na(duration)) %>%
  mutate(date = as.POSIXct(date))

#### Plot presets ####
duration_mins <- "Duration (mins)"
```

Data in this summary is [limited to the 100 most recent episodes](https://twitter.com/caseyliss/status/706885764236361728) in the feed.

At least that was the case until November 2016, when [Marco pointed out](https://twitter.com/marcoarment/status/801550714568900608) to me that there was, indeed, a better place for me to scrape episode data. 

In the meantime, I had [taken John's advice](https://twitter.com/siracusa/status/801444008404914176) and started [downloading every ATP episode ever as mp3](https://twitter.com/Jemus42/status/801451942560022528) to manually [mediainfo](https://en.wikipedia.org/wiki/MediaInfo) the duration out of them in a script, only to realize that the first few episodes [didn't have title information](https://twitter.com/Jemus42/status/801504118816833536) in them. This left only the option of crawling the ATP website for full episode metadata (which is annoying because of non-trivial URL parameters for pagination), which I was very much about to do… until I got Marco's reply.  
So… thanks Marco for saving me from the horrible fate that would have been a while loop in R.

## Episode Duration

```{r atp_duration, fig.height=6, fig.width=10}
ggplot(atp, aes(x = date, y = duration)) +
  geom_point(alpha = .5, size = 2) +
  geom_label_repel(data = filter(atp, duration > 160),
                   aes(label = title)) +
  expand_limits(y = 0) +
  geom_smooth(method = lm, formula = y ~ x, se = FALSE, color = "red") +
  scale_x_datetime(breaks = date_breaks("1 year"), 
                   minor_breaks = date_breaks("4 months"),
                   date_labels = "%Y") +
  scale_y_continuous(breaks = seq(0, 300, 30),
                     minor_breaks = seq(0, 300, 15)) +
  labs(title = "ATP Episode Durations",
       x = "Date Published", y = "Duration (mins)", caption = caption) +
  theme_ipsum(grid = "XY")
```

### Duration by Month

```{r atp_duration_month}
atp %>%
  ggplot(data = ., aes(x = month, y = duration)) +
  geom_boxplot() +
  stat_summary(fun = mean, geom = "point", color = "red") +
  #facet_grid(.~year, scales = "free_x", space = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  scale_y_continuous(
    breaks = seq(0, 300, 30),
    minor_breaks = seq(0, 300, 15)
  ) +
  labs(title = "ATP Episode Durations grouped by Month",
       subtitle = "Duration by month with average (dot)",
       x = "Month", y = "Duration (mins)", caption = caption) +
  theme_ipsum(grid = "Y") +
  theme(
    strip.text = element_text(size = rel(1)),
    axis.text.x = element_text(size = rel(.9), hjust = 1)
  )

atp %>%
  group_by(month) %>%
  mutate(dur_mean = mean(duration)) %>%
  ggplot(aes(x = reorder(month, dur_mean), y = duration)) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar") +
  stat_summary(fun = "mean", geom = "point", color = "red", size = 2) +
  scale_y_continuous(breaks = seq(0, 300, 15),
                     minor_breaks = seq(0, 300, 5)) +
  coord_flip() +
  labs(title = "ATP Average Episode Duration by Month",
       x = "Month", y = "Duration (mins) + 95% CI", caption = caption) +
  theme_ipsum(grid = "Xx")
```

### Duration by Year

```{r atp_duration_year}
atp %>%
  mutate(month = month(date, label = T, abbr = T),
         year = year(date)) %>%
  group_by(year) %>%
  ggplot(data = ., aes(x = as.factor(year), y = duration)) +
  geom_boxplot() +
  stat_summary(fun = mean, geom = "point", color = "red") +
  scale_y_continuous(
    breaks = seq(0, 300, 30),
    minor_breaks = seq(0, 300, 15)
  ) +
  labs(
    title = "ATP Episode Durations per Year",
    x = "", y = "Duration (mins)", caption = caption
  ) +
  theme_ipsum(grid = "Y") +
  theme(strip.text = element_text(size = rel(1)),
        axis.text.x = element_text(size = rel(1.5)),
        axis.ticks.x = element_blank())
```

## Raw Data 

```{r atp_episodes_table}
atp %>%
  mutate(duration = round(duration, 2)) %>%
  datatable(style = "bootstrap", 
            colnames = c("#", "Title", "Date", "Month", "Year", "Duration (mins)", "Summary"))
```

