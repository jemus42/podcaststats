---
title: "Podcast Data for the Lulz"
output:
  html_document
editor_options: 
  chunk_output_type: console
---

```{r global_options, include=FALSE}
source("00_setup.R")

opts_chunk$set(
  fig.path = "assets/plots/main/"
)

relay <- readRDS("data/relay.rds")
atp   <- readRDS("data/atp.rds")
incomparable_master_wide <- readRDS("data/incomparable_master_wide.rds")
```

I'm migrating this from the old location to here, cleaning up the code and improving it when I can.  
The new repo is located [here](https://github.com/jemus42/podcaststats).  

This is still under maintenance, and I'll replace this text when I consider it done(ish).

## All Shows

Here's a quick overview of the podcast data I've collected so far.  

```{r allshows}
relay %<>%
  mutate(number = as.character(number),
         year = year(date),
         date = as.POSIXct(date),
         network = "Relay.FM")

atp %<>%
  filter(!is.na(month)) %>%
  mutate(number = as.character(number),
         year = year(date),
         date = as.POSIXct(date),
         network = "ATP",
         podcast = "ATP")

incomparable_master_wide %<>%
  mutate(number = as.character(number),
         year = year(date),
         network = "The Incomparable")

podcasts <- incomparable_master_wide %>%
  full_join(relay) %>%
  full_join(atp)

podcasts %>%
  group_by(network) %>%
  summarize(
    episodes     = n(),
    duration_d   = round(sum(duration, na.rm = TRUE)/60/24),
    duration_avg = round(mean(duration, na.rm = TRUE)),
    firstep      = as.character(as.Date(min(date, na.rm = TRUE))),
    lastep       = as.character(as.Date(max(date, na.rm = TRUE))),
    shows        = length(unique(podcast)),
    epspershow   = round(episodes/shows, 1)
  ) %>%
  set_colnames(c("Network", "Episodes", "Duration (total, days)",
                 "Duration (mean, mins)", "First Episode",
                 "Last Episode", "# of Shows", "Episodes per Show")) %>%
  datatable()
```

## All Shows Timeline

From first to last published episode.

```{r allshows_timeline, fig.height=12}
podcasts %>%
  group_by(podcast) %>%
  mutate(d_min = min(date),
         d_max = max(date)) %>%
  ggplot(aes(x = reorder(podcast, d_min), color = network)) +
  geom_errorbar(aes(ymin = d_min, ymax = d_max),
                width = .5, size = 2) +
  scale_x_discrete(position = "top") +
  coord_flip() +
  theme(legend.position = "top") +
  labs(title = "All Podcasts Timeline", 
       subtitle = "The Incomparable, Relay.fm, ATP",
       x = "", y = "First to Latest Episode Date", 
       color = "Network",
       caption = caption) +
  theme(legend.position = "top")
```


## All Shows by Duration

```{r allshows_duration, fig.height=12}
podcasts %>%
  ggplot(aes(x = reorder(podcast, duration), y = duration, fill = network)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Podcasts by Duration", subtitle = "By Network",
       x = "", y = "Duration (mins)", fill = "Network") +
  theme(legend.position = "top")
```


## Placeholder Quickie: Defocused vs. Reconcilable Differences

```{r recdiffs_vs_defocused}
defocused <- readRDS("data/incomparable_master_wide.rds") %>% 
                filter(podcast == "Defocused") %>%
                mutate(number = as.numeric(number),
                       year = as.numeric(year))

recdiffs  <- readRDS("data/relay.rds") %>% 
                mutate(date = as.POSIXct(date)) %>%
                filter(podcast == "Reconcilable Differences")

data <- full_join(recdiffs, defocused)

ggplot(data = data, aes(x = podcast, y = duration, fill = podcast)) +
  geom_violin(draw_quantiles = c(.25, .75), alpha = .7, show.legend = F) +
  stat_summary(fun.y = mean, geom = "point", size = 2, show.legend = F) +
  scale_color_brewer() +
  coord_flip() +
  theme(legend.position = "top") +
  labs(title = "Defocused vs. Reconcilable Differences",
       subtitle = "Comparison of Show Durations (Violin Plot)", 
       x = "", y = "Duration (mins)", fill = "Show")
```
