---
title: "The Incomparable 10th Anniversary Special"
date: "`r format(Sys.time(), '%F %R', tz = 'UTC', usetz = T)`"
author: "Lukas â€” @jemus42"
output: 
  html_document:
    fig_height: 8
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
source("00_setup.R")

#### Global options ####
knitr::opts_chunk$set(
  fig.path = "assets/plots/incomparable_tenth/"
)

incomparable_wide <- readRDS("data/incomparable_master_wide.rds") %>%
  filter(podcast == "The Incomparable") %>%
  filter(!str_detect(number, "[a-z]$"))

incomparable <- readRDS("data/incomparable_master.rds") %>%
  filter(podcast == "The Incomparable") %>%
  filter(!str_detect(number, "[a-z]$"))
```

The latest episode in the current dataset:

```{r tenth-latest-data}
incomparable_wide %>%
  head(1) %>%
  select(number, date, title, host, guest) %>%
  mutate(date = as.Date(date)) %>%
  kable()
```


## All the panelists!

```{r tenth-panelists}
incomparable %>%
  count(person, role) %>%
  pivot_wider(names_from = role, values_from = n, values_fill = 0) %>%
  mutate(
    total = guest + host,
    total_perc = total / nrow(incomparable_wide),
    rank = rank(-total, ties.method = "min")
  ) %>%
  arrange(desc(total)) %>%
  select(rank, person, host, guest, total, total_perc) %>%
  datatable(
    style = "bootstrap",
    colnames = c("Rank", "Person", "Host", "Guest", "Total", "Total %"), 
    rownames = FALSE,
    options = list(
       pageLength = 25,
       lengthMenu = c(10, 25, 50, 100)
    )
  ) %>%
  formatPercentage(columns = 6, digits = 1)

# incomparable %>%
#   count(person, role) %>%
#   pivot_wider(names_from = role, values_from = n, values_fill = 0) %>%
#   mutate(
#     total = guest + host,
#     total_perc = total / nrow(incomparable_wide),
#     rank = rank(-total)
#   ) %>%
#   arrange(rank)
```

## By Segment

The segments the dataset knows about, with episode count:

```{r tenth-segments}
incomparable_wide %>%
  count(segment, sort = TRUE) %>%
  replace_na(replace = list(segment = "(General)")) %>%
  kable()
```


```{r tenth-segments-panelists}
incomparable %>%
  count(segment, person, role) %>%
  filter(!is.na(segment)) %>%
  pivot_wider(names_from = role, values_from = n, values_fill = 0) %>%
  mutate(
    total = guest + host,
    total_perc = total / nrow(incomparable_wide),
    rank = rank(-total, ties.method = "min")
  ) %>%
  arrange(segment, desc(total)) %>%
  select(segment, rank, person, host, guest, total, total_perc) %>%
  datatable(
    style = "bootstrap",
    colnames = c("Segment", "Rank", "Person", "Host", "Guest", "Total", "Total %"), 
    rownames = FALSE,
    filter = "top",
    extensions = "RowGroup",
    options = list(
       rowGroup = list(dataSrc = 0),
       pageLength = 50,
       lengthMenu = c(10, 25, 50, 75, 120)
    )
  ) %>%
  formatPercentage(columns = 7, digits = 1)
```

